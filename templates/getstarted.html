<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Teknofokus</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="static/img/logo5.jpeg" rel="icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="static/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="static/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="static/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="static/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="static/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="static/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Green
  * Template URL: https://bootstrapmade.com/green-free-one-page-bootstrap-template/
  * Updated: Mar 17 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>
  
  <!-- ======= Header ======= -->
  <header id="header" class="d-flex align-items-center">
    <div class="container d-flex align-items-center justify-content-between">
      <h1 class="logo me-auto d-flex align-items-center">
        <a href="index.html">
          <img src="static/img/logo5.jpeg" alt="Teknofokus Logo" class="logo-img"> Teknofokus
        </a>
      </h1>
      </a>
      <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
      <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>
      <nav id="navbar" class="navbar">
        <ul>
          <li><a href="getstarted.html" class="active">Get Started</a></li>
          <li><a href="#detection" >Detection</a></li>
          <li><a href="/">Home</a></li>
        </ul>
      </nav><!-- .navbar -->
    </div>
  </header><!-- End Header -->

  <main id="main">
    <!-- ======= Cta Section ======= -->
    <section id="cta" class="cta">
      <div class="container">

        <div class="row">
          <div class="col-lg-9 text-center text-lg-start">
            <h3>Mulai Deteksi</h3>
            <p> Mari kita jelajahi kualitas tomat secara mendalam. Temukan kualitas terbaik dari setiap tomat dengan teknologi mutakhir kami. Mulai sekarang untuk memulai proses pendeteksian yang akurat dan andal. Tekan tombol di samping untuk memulai prosesnya.</p>
          </div>
          <div class="col-lg-3 cta-btn-container text-center">
            <a class="cta-btn align-middle" href="#detection">Detection</a>
          </div>
        </div>

      </div>
    </section><!-- End Cta Section -->
    


  <main id="main">

    <!-- ======= Featured Services Section ======= -->
    <section id="featured-services" class="featured-services section-bg">
      <div class="container">

        <div class="row no-gutters">
          <div class="col-lg-4 col-md-6">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-graph-up"></i></div>
              <h4 class="title"><a href="">Akurasi dan Kepastian</a></h4>
              <p class="description">Teknologi canggih kami meningkatkan akurasi dan kepastian dalam pendeteksian kualitas tomat. Sistem kami memastikan hanya tomat berkualitas terbaik yang dipilih, menjamin produk akhir yang unggul dan kepuasan pelanggan yang maksimal.</p>
            </div>
          </div>
          <div class="col-lg-4 col-md-6">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-clock"></i></div>
              <h4 class="title"><a href="">Pemantauan Real-time</a></h4>
              <p class="description">Dengan teknologi pemantauan real-time kami, kualitas tomat dapat dipantau secara langsung. Sistem kami menyediakan data aktual dan akurat, memastikan bahwa setiap tomat memenuhi standar kualitas tertinggi, sehingga meningkatkan efisiensi dan kepuasan pelanggan.</p>
            </div>
          </div>
          <div class="col-lg-4 col-md-6">
            <div class="icon-box">
              <div class="icon"><i class="bi bi-star-fill"></i></div>
              <h4 class="title"><a href="">Kualitas Buah</a></h4>
              <p class="description">Teknologi kami memastikan setiap tomat diperiksa teliti untuk menjamin kualitas tertinggi. Kami mengidentifikasi parameter penting seperti tingkat kematangan tomat sehingga hanya tomat terbaik yang dipilih untuk produk akhir yang unggul.</p>
            </div>
          </div>
        </div>

      </div>
    </section><!-- End Featured Services Section -->

    <section id="detection" class="detection">
      <div class="container">

        <div class="section-title">
          <h2>Detection</h2>
        </div>

        <div class="tab-content">
          <div class="tab-pane active show" id="tab-1">
            <div class="row">
              <!-- ========================= WEB CAMERA ======================== -->
              <div class="col-md-12 mt-3 mt-lg-0 d-flex justify-content-center align-items-center" data-aos="fade-up"
                data-aos-delay="100">
                <div class="card bg-light" style="width: 50%;">
                  <h5 class="card-header">PREVIEW REALTIME DETECTION</h5>
                  <div class="card-body d-flex justify-content-center align-items-center">
                    <img id="video-preview" style="width: 100%" src="{{ url_for('webapp') }}" alt="Webcam Preview">
                  </div>
                  <div class="card-footer" style="text-align: center;">
                    <button type="button" class="btn btn-success m-2" style="width: 20%;"
                      onclick="startWebcam()">Start</button>
                    <button type="button" class="btn btn-danger m-2" style="width: 20%;"
                      onclick="stopWebcam()">Stop</button>
                  </div>
                  <!-- ========================= SCRIPT CAMERA ======================== -->
                  <script>
                    async function startWebcam() {
                      try {
                        const response = await fetch('/webapp/start', { method: 'POST' });
                        const data = await response.json();

                        alert(data.message);

                        if (data.message === 'Webcam started successfully') {
                          document.getElementById('video-preview').src = "{{ url_for('webapp') }}";
                          startObjectDetection(); // Start object detection immediately
                        }
                      } catch (error) {
                        console.error('Error starting webcam:', error);
                      }
                    }
                    function stopWebcam() {
                      fetch('/webapp/stop', { method: 'POST' })
                        .then(response => response.json())
                        .then(data => {
                          alert(data.message);
                          if (data.message === 'Webcam stopped successfully') {
                            document.getElementById('video-preview').src = "";
                          }
                        })
                        .catch(error => {
                          console.error('Error stopping webcam:', error);
                        });
                    }
                    function startObjectDetection() {
                      // Fetch object detection results and update the UI
                      fetch('/detect_palm_fruit', { method: 'POST' })
                        .then(response => response.json())
                        .then(data => {
                          updateTableData(data.detectionResults);
                          updateChart(data.detectionResults.map(result => result.count));
                        })
                        .catch(error => {
                          console.error('Error fetching object detection data:', error);
                        });
                    }
                  </script>
                </div>
              </div><!-- End tab content item -->
            </div>

            <div class="row mt-5">
              <!-- ========================= CHART DATA ======================== -->
              <div class="col-md-6 mt-3 mt-lg-0 d-flex flex-column" data-aos="fade-up"
                data-aos-delay="100">
                <div class="card bg-light" style="width: 100%;">
                  <h5 class="card-header">CHART DATA</h5>
                  <div class="card-body">
                    <div id="detection-chart1" style="width: 100%;"><!-- Preview Chart Data ada disini--></div>
                  </div>
                  <div class="card-footer" style="text-align: center; width:100%;"></div>
                  <!-- ========================= SCRIPT CHART DATA CAMERA ======================== -->
                  <script>
                    document.addEventListener('DOMContentLoaded', function () {
                      // Initialize chart
                      var counts = [0, 0]; // Initial counts
                      var detectionChart = Plotly.newPlot('detection-chart1', [{
                        type: 'bar',
                        x: ['buah matang', 'buah mentah'],
                        y: counts,
                        marker: {
                          color: ['rgb(56,118,29)', 'rgb(191,13,13)']
                        }
                      }], {
                        title: 'Detection Counts Camera',
                        yaxis: {
                          title: 'Counts'
                        }
                      });
                      // Update chart function
                      function updateChart(newCounts) {
                        counts = newCounts;
                        Plotly.update('detection-chart1', { y: [counts] });
                      }
                      // Function to fetch counts from the server
                      function fetchCounts() {
                        fetch('/webapp/get_counts_camera')
                          .then(response => response.json())
                          .then(data => {
                            updateChart(data.counts);
                          })
                          .catch(error => {
                            console.error('Error fetching counts:', error);
                          });
                      }
                      // Periodically fetch counts
                      setInterval(fetchCounts, 1000); // Fetch every 1 seconds
                    });
                  </script>
                </div>
              </div><!-- End tab content item -->

              <!-- ========================= TABLE DATA ======================== -->
              <div class="col-md-6 mt-lg-0 d-flex flex-column" data-aos="fade-up"
                data-aos-delay="100">
                <div class="card bg-light" style="width: 100%;">
                  <h5 class="card-header">TABLE DATA</h5>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-dark table-striped" id="tableData1">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col">No.</th>
                            <th scope="col">Class Name</th>
                            <th scope="col">Count</th>
                          </tr>
                        </thead>
                        <tbody><!-- tabel akan tampil disini --></tbody>
                      </table>
                    </div>
                    <!-- ========================= SCRIPT TABLE DATA WEB CAMERA ======================== -->
                    <script>
                      document.addEventListener('DOMContentLoaded', function () {
                        // Function to update the table with new data
                        function updateTableData(data) {
                          var tbody = document.getElementById('tableData1').getElementsByTagName('tbody')[0];
                          // Clear existing rows
                          tbody.innerHTML = '';
                          // Iterate through the data and add rows to the table
                          for (var i = 0; i < data.length; i++) {
                            var row = tbody.insertRow(i);
                            var cell1 = row.insertCell(0);
                            var cell2 = row.insertCell(1);
                            var cell3 = row.insertCell(2);

                            cell1.innerHTML = i + 1; // No.
                            cell2.innerHTML = data[i].className; // Class Name
                            cell3.innerHTML = data[i].count; // Count
                          }
                        }
                        // Function to fetch and update table data from the server
                        function fetchTableData() {
                          fetch('/detect_palm_fruit', { method: 'POST' })
                            .then(response => response.json())
                            .then(data => {
                              updateTableData(data.detectionResults);
                            })
                            .catch(error => {
                              console.error('Error fetching table data:', error);
                            });
                        }
                        // Initial fetch and update of the table data
                        fetchTableData();
                        // Periodically fetch and update table data (adjust the interval based on your needs)
                        setInterval(fetchTableData, 1000); // Fetch every 5 seconds, for example
                      });
                    </script>
                  </div>
                  <div class="card-footer" style="text-align: center; width:100%;"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-pane" id="tab-2">
            <div class="row">
              <!-- ========================= UPLOAD IMAGE FILE ======================== -->
              <div class="col-md-12 mt-3 mt-lg-0 d-flex justify-content-center align-items-center" data-aos="fade-up"
                data-aos-delay="100">
                <div class="card bg-light" style="width: 50%;">
                  <h5 class="card-header">UPLOAD IMAGE</h5>
                  <div class="card-body">
                    <input type="file" id="uploadInput">
                    <div class="d-flex justify-content-center align-items-center">
                      <canvas style="width: 60%; margin-top: 20px; display: none;"></canvas>
                    </div>
                  </div>
                  <div class="card-footer" style="text-align: center;"></div>
                  <!-- ========================= SCRIPT UPLOAD IMAGE FILE ======================== -->
                  <script>
                    const input = document.getElementById("uploadInput");
                    input.addEventListener("change", async (event) => {
                      const file = event.target.files[0];
                      const data = new FormData();
                      data.append("image_file", file, "image_file");
                      try {
                        const response = await fetch("/detect", {
                          method: "post",
                          body: data
                        });
                        if (!response.ok) {
                          throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        const boxes = await response.json();
                        draw_image_and_boxes(file, boxes);
                      }
                      catch (error) {
                        console.error('Error:', error);
                      }
                    })

                    function draw_image_and_boxes(file, boxes) {
                      const img = new Image()
                      img.src = URL.createObjectURL(file);
                      img.onload = () => {
                        const canvas = document.querySelector("canvas");
                        canvas.width = img.width;
                        canvas.height = img.height;
                        canvas.style.display = "block"; // Show the canvas
                        const ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0);
                        ctx.strokeStyle = "#00FF00";
                        ctx.lineWidth = 3;
                        ctx.font = "18px serif";
                        boxes.forEach(([x1, y1, x2, y2, label]) => {
                          ctx.strokeRect(x1, y1, x2 - x1, y2 - y1);
                          ctx.fillStyle = "#00ff00";
                          const width = ctx.measureText(label).width;
                          ctx.fillRect(x1, y1, width + 10, 25);
                          ctx.fillStyle = "#000000";
                          ctx.fillText(label, x1, y1 + 18);
                        });
                      }
                    }
                  </script>
                </div>
              </div><!-- End tab content item -->
            </div>
            <div class="row mt-5">
              <!-- ========================= CHART DATA UPLOAD ======================== -->
              <div class="col-md-6 mt-3 mt-lg-0 d-flex flex-column" data-aos="fade-up"
                data-aos-delay="100">
                <div class="card bg-light" style="width: 100%;">
                  <h5 class="card-header">CHART DATA</h5>
                  <div class="card-body">
                    <div id="detection-chart2" style="width: 600px; height: 450px;"><!-- Preview Chart Data ada disini--></div>
                  </div>
                  <div class="card-footer" style="text-align: center; width:100%;"></div>
                  <!-- ========================= SCRIPT CHART DATA UPLOAD ======================== -->
                  <script>
                    document.addEventListener('DOMContentLoaded', function () {
                      // Initialize chart
                      var counts = [0, 0]; // Initial counts
                      var detectionChart = Plotly.newPlot('detection-chart2', [{
                        type: 'bar',
                        x: ['buah matang', 'buah mentah'],
                        y: counts,
                        marker: {
                          color: ['rgb(56,118,29)', 'rgb(191,13,13)']
                        }
                      }], {
                        title: 'Detection Counts Upload',
                        yaxis: {
                          title: 'Counts'
                        }
                      });
                      // Update chart function
                      function updateChart(newCounts) {
                        counts = newCounts;
                        Plotly.update('detection-chart2', { y: [counts] });
                      }
                      // Function to fetch counts from the server
                      function fetchCounts() {
                        fetch('/webapp/get_counts_upload')
                          .then(response => response.json())
                          .then(data => {
                            updateChart(data.counts);
                          })
                          .catch(error => {
                            console.error('Error fetching counts:', error);
                          });
                      }
                      // Periodically fetch counts
                      setInterval(fetchCounts, 1000); // Fetch every 1 seconds
                    });
                  </script>
                </div>
              </div><!-- End tab content item -->

              <!-- ========================= TABLE DATA UPLOAD ======================== -->
              <div class="col-md-6 mt-lg-0 d-flex flex-column" data-aos="fade-up"
                data-aos-delay="100">
                <div class="card bg-light" style="width: 100%;">
                  <h5 class="card-header">TABLE DATA</h5>
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-dark table-striped" id="tableData2">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col">No.</th>
                            <th scope="col">Class Name</th>
                            <th scope="col">Count</th>
                          </tr>
                        </thead>
                        <tbody><!-- tabel akan tampil disini --></tbody>
                      </table>
                    </div>
                    <!-- ========================= SCRIPT TABLE DATA UPLOAD ======================== -->
                    <script>
                      document.addEventListener('DOMContentLoaded', function () {
                        // Function to update the table with new data
                        function updateTableData(data) {
                          var tbody = document.getElementById('tableData2').getElementsByTagName('tbody')[0];
                          // Clear existing rows
                          tbody.innerHTML = '';
                          // Iterate through the data and add rows to the table
                          for (var i = 0; i < data.length; i++) {
                            var row = tbody.insertRow(i);
                            var cell1 = row.insertCell(0);
                            var cell2 = row.insertCell(1);
                            var cell3 = row.insertCell(2);

                            cell1.innerHTML = i + 1; // No.
                            cell2.innerHTML = data[i].className; // Class Name
                            cell3.innerHTML = data[i].count; // Count
                          }
                        }
                        // Function to fetch and update table data from the server
                        function fetchTableData() {
                          fetch('/detect_upload', { method: 'POST' })
                            .then(response => response.json())
                            .then(data => {
                              updateTableData(data.detectionResults);
                            })
                            .catch(error => {
                              console.error('Error fetching table data:', error);
                            });
                        }
                        // Initial fetch and update of the table data
                        fetchTableData();
                        // Periodically fetch and update table data (adjust the interval based on your needs)
                        setInterval(fetchTableData, 1000); // Fetch every 5 seconds, for example
                      });
                    </script>
                  </div>
                  <div class="card-footer" style="text-align: center; width:100%;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <h3>Teknofokus</h3>
      <p>Solusi Cerdas untuk Hasil Panen Lebih Baik. Bergabunglah dengan Kami untuk Meningkatkan Produktivitas Pertanian Anda</p>
      <div class="social-links">
        <a href="#" class="twitter"><i class="bx bxl-twitter"></i></a>
        <a href="#" class="facebook"><i class="bx bxl-facebook"></i></a>
        <a href="#" class="instagram"><i class="bx bxl-instagram"></i></a>
        <a href="#" class="google-plus"><i class="bx bxl-skype"></i></a>
        <a href="#" class="linkedin"><i class="bx bxl-linkedin"></i></a>
      </div>
      <div class="copyright">
        &copy; Copyright <strong><span>Teknofokus</span></strong>. All Rights Reserved
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/green-free-one-page-bootstrap-template/ -->
        Designed by <a href="https://bootstrapmade.com/">YADAI</a>
      </div>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="{{url_for('static', filename = 'vendor/bootstrap/js/bootstrap.bundle.min.js')}}"></script>
  <script src="{{url_for('static', filename = 'vendor/aos/aos.js')}}"></script>
  <script src="{{url_for('static', filename = 'vendor/glightbox/js/glightbox.js')}}"></script>
  <script src="{{url_for('static', filename = 'vendor/isotope-layout/isotope.pkgd.min.js')}}"></script>
  <script src="{{url_for('static', filename = 'vendor/swiper/swiper-bundle.min.js')}}"></script>
  <script src="{{url_for('static', filename = 'vendor/purecounter/purecounter_vanilla.js')}}"></script>
  <script src="{{url_for('static', filename = 'vendor/php-email-form/validate.js')}}"></script>

  <!-- Template Main JS File -->
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>

</body>
</html>